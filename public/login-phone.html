<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - TG Controller</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Tailwind Config (TailAdmin theme) -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3C50E0',
                        stroke: '#E2E8F0',
                    },
                },
            },
        }
    </script>
</head>
<body class="bg-gray-100">
    
    <div class="flex min-h-screen">
        
        <!-- Left Side - Login Form -->
        <div class="flex w-full flex-col lg:w-1/2">
            
            <div class="flex min-h-screen items-center justify-center px-6 py-12">
                <div class="w-full max-w-md">
                    
                    <!-- Logo -->
                    <div class="mb-10 text-center">
                        <h1 class="text-4xl font-bold text-black mb-2">
                            ü§ñ TG Controller
                        </h1>
                        <p class="text-bodydark2">Manage all your Telegram bots from one dashboard</p>
                    </div>

                    <!-- Login Form Card -->
                    <div class="rounded-sm border border-stroke bg-white shadow-default">
                        <div class="border-b border-stroke py-4 px-7">
                            <h3 class="font-medium text-black">
                                Sign In with Telegram
                            </h3>
                        </div>
                        
                        <div class="p-7">
                            
                            <!-- Step 1: Phone Number -->
                            <div id="step1">
                                <div class="mb-4">
                                    <label class="mb-2.5 block font-medium text-black">
                                        Phone Number
                                    </label>
                                    <div class="relative">
                                        <input
                                            type="tel"
                                            id="phoneNumber"
                                            placeholder="+1234567890"
                                            class="w-full rounded border border-stroke bg-transparent py-3 px-5 outline-none focus:border-primary active:border-primary"
                                        />
                                        <span class="absolute right-4 top-4 text-bodydark2">
                                            üì±
                                        </span>
                                    </div>
                                    <p class="text-xs text-bodydark2 mt-2">
                                        Enter your phone number with country code
                                    </p>
                                </div>

                                <button
                                    onclick="sendCode()"
                                    class="w-full cursor-pointer rounded border border-primary bg-primary p-3 text-white transition hover:bg-opacity-90"
                                >
                                    Send Code
                                </button>
                            </div>

                            <!-- Step 2: SMS Code -->
                            <div id="step2" class="hidden">
                                <div class="mb-4">
                                    <label class="mb-2.5 block font-medium text-black">
                                        Verification Code
                                    </label>
                                    <input
                                        type="text"
                                        id="smsCode"
                                        placeholder="Enter 5-digit code"
                                        maxlength="5"
                                        class="w-full rounded border border-stroke bg-transparent py-3 px-5 text-center text-2xl tracking-widest outline-none focus:border-primary"
                                    />
                                    <p class="text-xs text-bodydark2 mt-2">
                                        Check your Telegram app for the code
                                    </p>
                                </div>

                                <button
                                    onclick="verifyCode()"
                                    class="w-full cursor-pointer rounded border border-primary bg-primary p-3 text-white transition hover:bg-opacity-90 mb-3"
                                >
                                    Verify Code
                                </button>

                                <button
                                    onclick="backToPhone()"
                                    class="w-full cursor-pointer rounded border border-stroke p-3 text-black transition hover:bg-gray-50"
                                >
                                    ‚Üê Back
                                </button>
                            </div>

                            <!-- Step 3: 2FA Password -->
                            <div id="step3" class="hidden">
                                <div class="mb-4">
                                    <label class="mb-2.5 block font-medium text-black">
                                        2FA Password
                                    </label>
                                    <input
                                        type="password"
                                        id="password"
                                        placeholder="Enter your password"
                                        class="w-full rounded border border-stroke bg-transparent py-3 px-5 outline-none focus:border-primary"
                                    />
                                    <p class="text-xs text-bodydark2 mt-2">
                                        Your account has two-factor authentication enabled
                                    </p>
                                </div>

                                <button
                                    onclick="verifyPassword()"
                                    class="w-full cursor-pointer rounded border border-primary bg-primary p-3 text-white transition hover:bg-opacity-90 mb-3"
                                >
                                    Verify Password
                                </button>

                                <button
                                    onclick="backToPhone()"
                                    class="w-full cursor-pointer rounded border border-stroke p-3 text-black transition hover:bg-gray-50"
                                >
                                    ‚Üê Start Over
                                </button>
                            </div>

                        </div>
                    </div>

                    <!-- Info Message -->
                    <div class="mt-6 rounded-sm border border-[#3C50E0] border-opacity-20 bg-[#3C50E0] bg-opacity-5 p-4">
                        <p class="text-sm text-[#3C50E0]">
                            <strong>Note:</strong> This is secure authentication via Telegram API. Your credentials are never stored.
                        </p>
                    </div>

                </div>
            </div>

        </div>

        <!-- Right Side - Background -->
        <div class="hidden lg:flex lg:w-1/2 bg-gradient-to-br from-primary to-purple-600 items-center justify-center p-12">
            <div class="text-center text-white">
                <div class="text-8xl mb-6">ü§ñ</div>
                <h2 class="text-4xl font-bold mb-4">Welcome Back!</h2>
                <p class="text-xl opacity-90">
                    Manage all your Telegram bots from one powerful dashboard
                </p>
                <div class="mt-12 grid grid-cols-3 gap-6 text-center">
                    <div>
                        <div class="text-3xl font-bold">15+</div>
                        <div class="text-sm opacity-75">Bots Managed</div>
                    </div>
                    <div>
                        <div class="text-3xl font-bold">24/7</div>
                        <div class="text-sm opacity-75">Monitoring</div>
                    </div>
                    <div>
                        <div class="text-3xl font-bold">Real-time</div>
                        <div class="text-sm opacity-75">Statistics</div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        let currentStep = 1;
        let phoneNumber = '';

        function showStep(step) {
            document.getElementById('step1').classList.add('hidden');
            document.getElementById('step2').classList.add('hidden');
            document.getElementById('step3').classList.add('hidden');
            document.getElementById('step' + step).classList.remove('hidden');
            currentStep = step;
        }

        function showToast(message, type = 'info') {
            const colors = {
                success: '#10ac84',
                error: '#ff4757',
                info: '#3C50E0',
                warning: '#f39c12'
            };
            
            const toast = document.createElement('div');
            toast.textContent = message;
            toast.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                background: ${colors[type] || colors.info};
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                z-index: 10000;
                animation: slideIn 0.3s ease;
                max-width: 300px;
            `;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        async function sendCode() {
            phoneNumber = document.getElementById('phoneNumber').value.trim();
            
            if (!phoneNumber || !phoneNumber.startsWith('+')) {
                showToast('Please enter phone number with country code (e.g., +1234567890)', 'warning');
                return;
            }

            try {
                showToast('Sending code...', 'info');
                const response = await fetch('/auth/phone/send-code', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ phone: phoneNumber })
                });

                const data = await response.json();

                if (data.success) {
                    showToast('Code sent! Check your Telegram app', 'success');
                    showStep(2);
                    document.getElementById('smsCode').focus();
                } else {
                    showToast(data.error || 'Failed to send code', 'error');
                }
            } catch (error) {
                showToast('Error: ' + error.message, 'error');
            }
        }

        async function verifyCode() {
            const code = document.getElementById('smsCode').value.trim();
            
            if (!code || code.length !== 5) {
                showToast('Please enter the 5-digit code', 'warning');
                return;
            }

            try {
                showToast('Verifying...', 'info');
                const response = await fetch('/auth/phone/verify-code', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ phone: phoneNumber, code: code })
                });

                const data = await response.json();

                if (data.success) {
                    showToast('Login successful!', 'success');
                    setTimeout(() => {
                        window.location.href = '/bots.html';
                    }, 1000);
                } else if (data.needPassword) {
                    showToast('2FA required', 'info');
                    showStep(3);
                    document.getElementById('password').focus();
                } else {
                    showToast(data.error || 'Invalid code', 'error');
                }
            } catch (error) {
                showToast('Error: ' + error.message, 'error');
            }
        }

        async function verifyPassword() {
            const password = document.getElementById('password').value;
            
            if (!password) {
                showToast('Please enter your 2FA password', 'warning');
                return;
            }

            try {
                showToast('Verifying password...', 'info');
                const response = await fetch('/auth/phone/verify-password', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ phone: phoneNumber, password: password })
                });

                const data = await response.json();

                if (data.success) {
                    showToast('Login successful!', 'success');
                    setTimeout(() => {
                        window.location.href = '/bots.html';
                    }, 1000);
                } else {
                    showToast(data.error || 'Invalid password', 'error');
                }
            } catch (error) {
                showToast('Error: ' + error.message, 'error');
            }
        }

        function backToPhone() {
            showStep(1);
            document.getElementById('smsCode').value = '';
            document.getElementById('password').value = '';
        }

        // Auto-focus on load
        window.onload = () => {
            document.getElementById('phoneNumber').focus();
        };

        // Add toast animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(400px); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(400px); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
